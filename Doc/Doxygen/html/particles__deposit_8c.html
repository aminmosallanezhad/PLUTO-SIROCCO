<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PLUTO: /Users/mignone/PLUTO/Src/Particles/particles_deposit.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PLUTO<span id="projectnumber">&#160;4.4-patch3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_413f4e031a85da0d68269c6fd2f76e1c.html">Src</a></li><li class="navelem"><a class="el" href="dir_9206b596ebf640a5bddb105d741e15ea.html">Particles</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">particles_deposit.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p><a class="el" href="struct_particle.html">Particle</a> to grid deposition functions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="pluto_8h_source.html">pluto.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:af82a69ba6dd401c6e57a0bcb19d8f1eb" id="r_af82a69ba6dd401c6e57a0bcb19d8f1eb"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af82a69ba6dd401c6e57a0bcb19d8f1eb">NELEM_MAX</a>&#160;&#160;&#160;64</td></tr>
<tr class="separator:af82a69ba6dd401c6e57a0bcb19d8f1eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a615c9a8c455089ce38d0f2a6321c8dbd" id="r_a615c9a8c455089ce38d0f2a6321c8dbd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a615c9a8c455089ce38d0f2a6321c8dbd">Particles_Deposit</a> (<a class="el" href="structparticle_node.html">particleNode</a> *PHead, void(*Func)(<a class="el" href="struct_particle.html">Particle</a> *, double *), <a class="el" href="pluto_8h.html#a8687756c20ea6b5b5987615b0ce41bd2">Data_Arr</a> Q, int nelem, <a class="el" href="struct_grid.html">Grid</a> *grid)</td></tr>
<tr class="separator:a615c9a8c455089ce38d0f2a6321c8dbd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f4dd7ffd1735a72c93ae099161ed865" id="r_a4f4dd7ffd1735a72c93ae099161ed865"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4f4dd7ffd1735a72c93ae099161ed865">Particles_DepositBoundaryExchange</a> (<a class="el" href="pluto_8h.html#a8687756c20ea6b5b5987615b0ce41bd2">Data_Arr</a> Q, int nelem, <a class="el" href="struct_grid.html">Grid</a> *grid)</td></tr>
<tr class="separator:a4f4dd7ffd1735a72c93ae099161ed865"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a758be08b57d19c967a7f31a71ad814e8" id="r_a758be08b57d19c967a7f31a71ad814e8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a758be08b57d19c967a7f31a71ad814e8">Particles_Density</a> (<a class="el" href="struct_particle.html">Particle</a> *p, double *qd)</td></tr>
<tr class="separator:a758be08b57d19c967a7f31a71ad814e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><br  />
 </p>
<p>Transfer particle quantities to the grid using deposition:   </p><p class="formulaDsp">
<picture><source srcset="form_232_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[
   Q_{ijk} = \sum_p W_p(x_{ijk}-x_p)q_p
\]" src="form_232.png"/></picture>
</p>
<p> where <code>qp</code> is a particle-related quantities (e.g. energy or mass). For deposition to be consistently done, particles can be everywhere in the domain, including ghost zones with the important exception of the very first and very last one. An error will occur in <a class="el" href="particles_8h.html#ab9f5cb6175c067b45e6ea5b1bf801d5c">Particles_GetWeights()</a> otherwise.</p>
<p>Alternatively, integer deposition can be used to verify the correctness of serial/parallel implementation:    </p><p class="formulaDsp">
<picture><source srcset="form_233_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[
   Q_{ijk} = \frac{q_{\max}}{C} \sum_p {\rm int}\left(C
             W_p(x_{ijk}-x_p) \frac{q_p}{q_{\max}}\right)
\]" src="form_233.png"/></picture>
</p>
<p> where <code>C</code> is a large number (<code>1.e6</code> by default) while <code>q_max</code> is the maximum value of <code>qp</code> over all particles.</p>
<p>Deposition is always followed by a boundary condition call, since quantities deposited in the ghost zones must be exchanged with neighbour processors.</p>
<dl class="section author"><dt>Authors</dt><dd>A. Mignone (<a href="#" onclick="location.href='mai'+'lto:'+'and'+'re'+'a.m'+'ig'+'non'+'e@'+'uni'+'to'+'.it'; return false;">andre<span class="obfuscator">.nosp@m.</span>a.mi<span class="obfuscator">.nosp@m.</span>gnone<span class="obfuscator">.nosp@m.</span>@uni<span class="obfuscator">.nosp@m.</span>to.it</a>)<br  />
 <b>References</b> </dd></dl>
<dl class="section date"><dt>Date</dt><dd>August 06, 2018 </dd></dl>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="af82a69ba6dd401c6e57a0bcb19d8f1eb" name="af82a69ba6dd401c6e57a0bcb19d8f1eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af82a69ba6dd401c6e57a0bcb19d8f1eb">&#9670;&#160;</a></span>NELEM_MAX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NELEM_MAX&#160;&#160;&#160;64</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a758be08b57d19c967a7f31a71ad814e8" name="a758be08b57d19c967a7f31a71ad814e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a758be08b57d19c967a7f31a71ad814e8">&#9670;&#160;</a></span>Particles_Density()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Particles_Density </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_particle.html">Particle</a> *</td>          <td class="paramname"><span class="paramname"><em>p</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *</td>          <td class="paramname"><span class="paramname"><em>qd</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Simple deposition function used to compute particle density on the grid. </p>

</div>
</div>
<a id="a615c9a8c455089ce38d0f2a6321c8dbd" name="a615c9a8c455089ce38d0f2a6321c8dbd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a615c9a8c455089ce38d0f2a6321c8dbd">&#9670;&#160;</a></span>Particles_Deposit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Particles_Deposit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structparticle_node.html">particleNode</a> *</td>          <td class="paramname"><span class="paramname"><em>PHead</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*</td>          <td class="paramname"><span class="paramname"><em>Func&#160;</em></span>)(<a class="el" href="struct_particle.html">Particle</a> *, double *), </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pluto_8h.html#a8687756c20ea6b5b5987615b0ce41bd2">Data_Arr</a></td>          <td class="paramname"><span class="paramname"><em>Q</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>nelem</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_grid.html">Grid</a> *</td>          <td class="paramname"><span class="paramname"><em>grid</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">PHead</td><td>pointer to particle Node </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Func()</td><td>pointe to function containing the quantity to be deposited on the grid </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">Q</td><td>The 4D data array on which func is deposited </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nelem</td><td>the number of elements </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="struct_grid.html">Grid</a></td><td>Pointer to a grid structure </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a4f4dd7ffd1735a72c93ae099161ed865" name="a4f4dd7ffd1735a72c93ae099161ed865"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f4dd7ffd1735a72c93ae099161ed865">&#9670;&#160;</a></span>Particles_DepositBoundaryExchange()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Particles_DepositBoundaryExchange </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pluto_8h.html#a8687756c20ea6b5b5987615b0ce41bd2">Data_Arr</a></td>          <td class="paramname"><span class="paramname"><em>Q</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>nelem</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_grid.html">Grid</a> *</td>          <td class="paramname"><span class="paramname"><em>grid</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Exchange boundary values between processors to complete the deposition process. If Q contains quantities in the boundaries, we first copy these values into auxiliary buffers <code>snd_bufL</code> and <code>snd_bufR</code> and then transfer them through an MPI Send/Recv call:</p>
<div class="fragment"><div class="line">Rank #0        A0|B0------C0|D0</div>
<div class="line">                          ^   |</div>
<div class="line">                          |   v </div>
<div class="line">Rank #1                   A1|<a class="code hl_define" href="cooling__ode__solver_8c.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>------C1|D1</div>
<div class="line">                                     ^   |</div>
<div class="line">                                     |   v</div>
<div class="line">Rank #2                              A2|<a class="code hl_define" href="cooling__ode__solver_8c.html#a6945d50f798e1fde624d70c74457090e">B2</a>------C2|D2</div>
<div class="ttc" id="acooling__ode__solver_8c_html_a6945d50f798e1fde624d70c74457090e"><div class="ttname"><a href="cooling__ode__solver_8c.html#a6945d50f798e1fde624d70c74457090e">B2</a></div><div class="ttdeci">#define B2</div><div class="ttdef"><b>Definition</b> cooling_ode_solver.c:419</div></div>
<div class="ttc" id="acooling__ode__solver_8c_html_a7b21d6a6a4573b4997b1f04b01cd4efb"><div class="ttname"><a href="cooling__ode__solver_8c.html#a7b21d6a6a4573b4997b1f04b01cd4efb">B1</a></div><div class="ttdeci">#define B1</div><div class="ttdef"><b>Definition</b> cooling_ode_solver.c:418</div></div>
</div><!-- fragment --><p>Seen from rank # 1, we have</p><ul>
<li><code>A1</code> = snd_bufL</li>
<li><code>D1</code> = snd_bufR</li>
<li><code>D0</code> = rcv_bufL</li>
<li><code>A2</code> = rcv_bufR</li>
</ul>
<p>Here 'L' or 'R' refer to the processor to the left (rank #0) and to the right (rank #2), respectively. In 2D or 3D we iterate over dimensions. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Sep 18 2024 14:17:59 for PLUTO by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
